<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">
      <div class="pull-right">
        <div class="btn-group">
          <a role="button"
             class="btn btn-default"
             ui-sref=".new"
          >
            Нов
            <i class="fa fa-file-o fa-fw"></i>
          </a>
        </div>
      </div>
      Наблюдения
    </h1>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-body">

        <form role="form" class="form form-filter">

          <div ng-if="$user.isAdmin()" class="form-group">
            <label for="owner">Наблюдател</label>

            <user-selector model-id="monitoringController.filter.user" name="user"
                           placeholder="- всички -" on-select="monitoringController.updateFilter()"></user-selector>
          </div>

          <div class="form-group">
            <label for="location">Локация</label>
            <location-selector name="location" model-id="monitoringController.filter.location"
                               on-select="monitoringController.updateFilter()"
                               placeholder="- всички -"></location-selector>
          </div>

          <!--<div class="form-group">-->
          <!--<label>Преброяване</label>-->
          <!--<ui-select ng-model="monitoringController.filter.monitoring" name="monitoring">-->
          <!--<ui-select-match allow-clear="true" placeholder="- всички -">{{$select.selected}}-->
          <!--</ui-select-match>-->
          <!--<ui-select-choices-->
          <!--repeat="monitoring in monitorings | filter:$select.search | limitTo:10">-->
          <!--<div ng-bind-html="monitoring | uibTypeaheadHighlight:$select.search"></div>-->
          <!--</ui-select-choices>-->
          <!--</ui-select>-->
          <!--</div>-->

          <div class="form-group">
            <label>Площадка</label>
            <ui-select ng-model="monitoringController.filter.zone" name="zone"
                       on-remove="monitoringController.updateFilter()"
                       on-select="monitoringController.updateFilter()">
              <ui-select-match allow-clear="true" placeholder="- всички -">{{$select.selected.id}}
              </ui-select-match>
              <ui-select-choices
                repeat="zone.id as zone in monitoringController.zones | filter:{
                  owner: {
                    id: $user.isAdmin()?$user.id:monitoringController.filter.user
                  },
                  location: {
                    id: monitoringController.filter.location
                  },
                } | filter:$select.search | orderBy:'toString()' | limitTo:30">
                <div ng-bind-html="zone | zoneToString | uibTypeaheadHighlight:$select.search"></div>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="form-group">
            <label>Посещение</label>
            <ui-select ng-model="monitoringController.filter.visit" name="visit"
                       on-remove="monitoringController.updateFilter()"
                       on-select="monitoringController.updateFilter()">
              <ui-select-match allow-clear="true" placeholder="- всички -">
                {{$select.selected.toString()}}
              </ui-select-match>
              <ui-select-choices
                repeat="item.slug as item in monitoringController.visits | filter:$select.search | orderBy:'toString()' | limitTo:30">
                <div ng-bind-html="item | nomenclatureToString | uibTypeaheadHighlight:$select.search"></div>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="form-group">
            <label>Година</label>
            <ui-select ng-model="monitoringController.filter.year" name="year"
                       on-remove="monitoringController.updateFilter()"
                       on-select="monitoringController.updateFilter()">
              <ui-select-match allow-clear="true" placeholder="- всички -">
                {{$select.selected.toString()}}
              </ui-select-match>
              <ui-select-choices
                repeat="item in monitoringController.years | filter:$select.search | limitTo:30">
                <div ng-bind-html="item | uibTypeaheadHighlight:$select.search"></div>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="form-group">
            <label>Вид</label>
            <ui-select ng-model="monitoringController.filter.species" name="species"
                       on-remove="monitoringController.updateFilter()"
                       on-select="monitoringController.updateFilter()">
              <ui-select-match allow-clear="true" placeholder="- всички -">
                {{$select.selected.toString()}}
              </ui-select-match>
              <ui-select-choices
                repeat="item.slug as item in monitoringController.species | filter:$select.search | orderBy:'toString()' | limitTo:30">
                <div ng-bind-html="item | nomenclatureToString | uibTypeaheadHighlight:$select.search"></div>
              </ui-select-choices>
            </ui-select>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <table class="table table-striped table-hover">
      <thead>
      <tr>
        <th ng-click="monitoringController.order.reverse = monitoringController.order.key=='id' && !monitoringController.order.reverse; monitoringController.order.key='id'">#</th>
        <th ng-if="$user.isAdmin()"
            ng-click="monitoringController.order.reverse = monitoringController.order.key=='user|userName' && !monitoringController.order.reverse; monitoringController.order.key='user|userName'">
          Потребител
        </th>
        <th
          ng-click="monitoringController.order.reverse = monitoringController.order.key=='visit.label.bg' && !monitoringController.order.reverse; monitoringController.order.key='visit.label.bg'">
          Преброяване
        </th>
        <th ng-click="monitoringController.order.reverse = monitoringController.order.key=='zone.id' && !monitoringController.order.reverse; monitoringController.order.key='zone.id'">
          Площадка
        </th>
        <th
          ng-click="monitoringController.order.reverse = monitoringController.order.key=='location.id' && !monitoringController.order.reverse; monitoringController.order.key='location.id'">
          Локация
        </th>
        <th
          ng-click="monitoringController.order.reverse = monitoringController.order.key=='date|date:\'yyyyMMddHHmmss\'' && !monitoringController.order.reverse; monitoringController.order.key='date|date:\'yyyyMMddHHmmss\''">
          Дата/час
        </th>
        <th ng-click="monitoringController.order.reverse = monitoringController.order.key=='species.label.bg' && !monitoringController.order.reverse; monitoringController.order.key='species.label.bg'">
          Вид
        </th>
        <th
          ng-click="monitoringController.order.reverse = monitoringController.order.key=='count' && !monitoringController.order.reverse; monitoringController.order.key='count'">
          Брой
        </th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="row in monitoringController.rows | orderBy:monitoringController.order.key:monitoringController.order.reverse"
          ng-click="$state.go('.detail', {id: row.id})">
        <td><a href ui-sref=".detail({id: row.id})">{{row.id}}</a></td>
        <td ng-if="$user.isAdmin()">{{row.user.firstName}} {{row.user.lastName}}</td>
        <td>{{row.visit.label.bg}}</td>
        <td>{{row.zone.id}}</td>
        <td>{{row.zone.location|locationLabel}}</td>
        <td>{{row.startDateTime|date:'d.MM.yyyy'}} {{row.startDateTime|date:'H:mm'}} - {{row.endDateTime|date:'H:mm'}}</td>
        <td>{{row.species.label.bg}}</td>
        <td>{{row.count}}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
